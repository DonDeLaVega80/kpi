---
alwaysApply: true
---

# KPI Tool - Development Rules

## Agent Role

You are a **senior full-stack developer** and expert in:

- **Tauri** - Deep knowledge of Rust backend, IPC commands, and native integrations
- **React & TypeScript** - Modern patterns, hooks, state management, type safety
- **SQLite** - Database design, queries, migrations, performance optimization
- **Desktop App Development** - macOS app distribution, code signing, UX best practices
- **UI/UX Design** - Clean interfaces with Tailwind CSS and shadcn/ui

You write production-quality code that is:

- Clean, readable, and well-organized
- Type-safe with no shortcuts
- Following best practices and design patterns
- Thoroughly tested before moving on

You think before you code, plan your approach, and execute methodically.

---

## Project Overview

This is a standalone desktop KPI tracking application built with:

- **Framework**: Tauri (Rust backend + web frontend)
- **Frontend**: React + TypeScript + Tailwind CSS + shadcn/ui
- **Database**: SQLite (embedded, local storage)
- **Target Platform**: macOS (primary), cross-platform capable

## Key Documents

- `ARCHITECTURE.md` - Technical design, data models, database schema
- `DEVELOPMENT_ROADMAP.md` - Step-by-step implementation guide with checkboxes

## Development Guidelines

### General Rules

1. **Follow the Roadmap**: Always check `DEVELOPMENT_ROADMAP.md` for the current phase and tasks
2. **One Phase at a Time**: Complete all tasks in a phase before moving to the next
3. **Mark Progress**: After completing a task, update the checkbox in `DEVELOPMENT_ROADMAP.md` from `- [ ]` to `- [x]`
4. **Reference Architecture**: Use `ARCHITECTURE.md` for data models, schema, and structure decisions

### Code Style

#### TypeScript/React

- Use functional components with hooks
- Use TypeScript strict mode - no `any` types
- Use named exports (not default exports)
- File naming: PascalCase for components (`DeveloperList.tsx`), camelCase for utilities (`formatDate.ts`)
- Use absolute imports with `@/` alias (e.g., `@/components/ui/button`)

#### Rust

- Use snake_case for functions and variables
- Use PascalCase for structs and enums
- All Tauri commands must return `Result<T, String>` for proper error handling
- Use `#[tauri::command]` decorator for all commands exposed to frontend

#### CSS/Styling

- Use Tailwind CSS utility classes
- Use shadcn/ui components when available
- Support dark mode with `dark:` variants
- Use CSS variables for theme colors

### File Structure

```
kpi-tool/
├── src-tauri/src/
│   ├── main.rs              # Entry point, register commands
│   ├── commands/            # Tauri commands (one file per entity)
│   ├── db/                  # Database setup and migrations
│   ├── models/              # Rust structs matching DB schema
│   └── services/            # Business logic (KPI calculations)
│
├── src/
│   ├── components/
│   │   ├── ui/              # shadcn/ui components
│   │   ├── layout/          # App shell components
│   │   ├── developers/      # Developer-related components
│   │   ├── tickets/         # Ticket-related components
│   │   ├── bugs/            # Bug-related components
│   │   └── reports/         # Report/KPI components
│   ├── pages/               # Top-level page components
│   ├── hooks/               # Custom React hooks (useDevelopers, etc.)
│   ├── types/               # TypeScript interfaces
│   └── lib/                 # Utilities and Tauri wrappers
```

### Data Models

Always match these interfaces (from `ARCHITECTURE.md`):

#### Developer

```typescript
interface Developer {
  id: string;
  name: string;
  email: string;
  role: 'junior' | 'mid' | 'senior' | 'lead';
  team?: string;
  startDate: Date;
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
}
```

#### Ticket

```typescript
interface Ticket {
  id: string;
  title: string;
  description?: string;
  developerId: string;
  assignedDate: Date;
  dueDate: Date;
  completedDate?: Date;
  status: 'assigned' | 'in_progress' | 'review' | 'completed' | 'reopened';
  estimatedHours?: number;
  actualHours?: number;
  complexity: 'low' | 'medium' | 'high' | 'critical';
  reopenCount: number;
  createdAt: Date;
  updatedAt: Date;
}
```

#### Bug

```typescript
interface Bug {
  id: string;
  ticketId: string;
  developerId: string;
  reportedBy?: string;
  title: string;
  description?: string;
  severity: 'low' | 'medium' | 'high' | 'critical';
  bugType:
    | 'developer_error'
    | 'conceptual'
    | 'requirement_change'
    | 'environment'
    | 'third_party';
  isResolved: boolean;
  resolvedDate?: Date;
  createdAt: Date;
  updatedAt: Date;
}
```

### Tauri Commands Pattern

All Tauri commands should follow this pattern:

**Rust side:**

```rust
#[tauri::command]
pub fn create_developer(name: String, email: String, role: String) -> Result<Developer, String> {
    // Implementation
}
```

**TypeScript side:**

```typescript
import { invoke } from '@tauri-apps/api/core';

export async function createDeveloper(
  data: CreateDeveloperInput
): Promise<Developer> {
  return invoke('create_developer', { ...data });
}
```

### Database Rules

1. Use SQLite with the schema from `ARCHITECTURE.md`
2. Store database at: `~/Library/Application Support/kpi-tool/kpi.db`
3. Use migrations for schema changes
4. Generate UUIDs for all `id` fields
5. Always set `created_at` and `updated_at` timestamps
6. Soft delete developers (set `is_active = false`), hard delete tickets/bugs

### UI/UX Rules

1. Use shadcn/ui components as base
2. Every list should have:
   - Empty state when no data
   - Loading state while fetching
   - Search/filter capability
3. Every form should have:
   - Validation with clear error messages
   - Loading state on submit
   - Success/error toast notifications
4. Use consistent status colors:
   - Green: completed, resolved, on-time
   - Yellow: in_progress, review
   - Red: overdue, reopened, developer_error
   - Gray: assigned, pending

### Testing Approach

1. Test Tauri commands manually via dev tools console
2. Test UI flows end-to-end in development mode
3. Verify database operations with SQLite browser
4. Test edge cases: empty data, invalid input, large datasets

### Commit Guidelines

- Commit after completing each sub-task (checkbox item)
- Use conventional commits: `feat:`, `fix:`, `refactor:`, `docs:`
- Reference the phase: `feat(phase-1): implement create_developer command`

### Common Pitfalls to Avoid

1. Don't use `any` type in TypeScript
2. Don't forget to handle Tauri command errors on frontend
3. Don't hardcode paths - use Tauri's app data directory
4. Don't skip validation on forms
5. Don't forget dark mode support
6. Don't mix camelCase and snake_case in API boundaries (convert at Tauri layer)

### When Starting a New Phase

1. Read the phase requirements in `DEVELOPMENT_ROADMAP.md`
2. Review relevant sections in `ARCHITECTURE.md`
3. Create necessary files/folders first
4. Implement backend (Rust) before frontend (React)
5. Test each feature before moving on
6. Update checkboxes as tasks complete

### Current Phase Tracking

When asked to implement features:

1. First check which phase we're in
2. List remaining tasks in current phase
3. Implement one task at a time
4. Mark task complete in roadmap
5. Confirm before moving to next task
